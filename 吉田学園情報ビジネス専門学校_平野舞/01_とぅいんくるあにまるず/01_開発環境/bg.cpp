//-----------------------------------------------------------------------------------------------
//
// 背景の処理[bg.cpp]
// Author : 平野舞
//
//-----------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------
// インクルードファイル
//-----------------------------------------------------------------------------------------------
#include "bg.h"					// 背景
#include "object2D.h"			// 2Dオブジェクト
#include "application.h"		// アプリケーション
#include "renderer.h"			// レンダリング
#include "VirtualController.h"	// 仮想コントローラー
#include "TextureFileName.h"	// 画像のファイル名

//-----------------------------------------------------------------------------------------------
// 定数宣言
//-----------------------------------------------------------------------------------------------
// 背景の移動スピード
static const float BG_SPPED = -0.001f;

//-----------------------------------------------------------------------------------------------
//　コンストラクタ
//-----------------------------------------------------------------------------------------------
CBg::CBg()
	:m_fTexV(0), m_nType(ETYPE_BG_NONE),m_page(TUTORIAL_PAGE_NONE)
{
	for (int nCntBg = 0; nCntBg < MAX_TEXTURE; nCntBg++)
	{
		m_paObject2D[nCntBg] = nullptr;
	}
}

//-----------------------------------------------------------------------------------------------
//　デストラクタ
//-----------------------------------------------------------------------------------------------
CBg::~CBg()
{

}

//-----------------------------------------------------------------------------------------------
// 生成
//-----------------------------------------------------------------------------------------------
CBg* CBg::Create(ETYPE_BG type)
{
	// ポインタを宣言
	CBg* pBG = new CBg;

	if (pBG != nullptr)
	{// nullptrではなかったら
		// 種類
		pBG->SetType(type);

		// 初期化する
		pBG->Init();
	}

	return pBG;
}

//-----------------------------------------------------------------------------------------------
//　初期化
//-----------------------------------------------------------------------------------------------
HRESULT CBg::Init()
{
	// オブジェクト2Dを生成
	m_paObject2D[0] = CObject2D::Create(nullptr, D3DXVECTOR3(CRenderer::SCREEN_WIDTH / 2.0f, CRenderer::SCREEN_HEIGHT / 2.0f, 0.0f),
		D3DXVECTOR3((float)CRenderer::SCREEN_WIDTH, (float)CRenderer::SCREEN_HEIGHT, 0.0f));

	// テクスチャ、親の設定
	switch (m_nType)
	{
		// タイトル
	case ETYPE_BG_TITLE:
		m_paObject2D[0]->LoadTexture(TEX_BG_TITLE);
		break;
		// チュートリアル
	case ETYPE_BG_TUTORIAL:
		m_paObject2D[0]->LoadTexture(TEX_BG_TUTORIAL_ONE);
		// オブジェクト2Dを生成
		m_paObject2D[1] = CObject2D::Create(TEX_BG_TOTORIAL_SECOND, D3DXVECTOR3(CRenderer::SCREEN_WIDTH / 2.0f, CRenderer::SCREEN_HEIGHT / 2.0f, 0.0f),
			D3DXVECTOR3((float)CRenderer::SCREEN_WIDTH, (float)CRenderer::SCREEN_HEIGHT, 0.0f));
		// 1ページ目を表示
		m_page = TUTORIAL_PAGE_ONE;
		break;
		// ゲーム
	case ETYPE_BG_GAME:
		m_paObject2D[0]->LoadTexture(TEX_BG_GAME);
		break;
		// ポーズ
	case ETYPE_BG_PAUSE:
		m_paObject2D[0]->LoadTexture(TEX_BG_PAUSE);
		SetObjectParent(CObject::EOBJECT_PARENT_PAUSE);
		break;
		// リザルト
	case ETYPE_BG_RESULT:
		m_paObject2D[0]->LoadTexture(TEX_BG_RESULT);
		break;
		// その他
	default:
		break;
	}

	return S_OK;
}

//-----------------------------------------------------------------------------------------------
//　終了
//-----------------------------------------------------------------------------------------------
void CBg::Uninit()
{
	for (int nCntBg = 0; nCntBg < MAX_TEXTURE; nCntBg++)
	{
		if (m_paObject2D[nCntBg] != nullptr)
		{// nullptrではなかったら
			// 終了する
			m_paObject2D[nCntBg]->Uninit();
		}
	}
}

//-----------------------------------------------------------------------------------------------
//　更新
//-----------------------------------------------------------------------------------------------
void CBg::Update()
{
	if (m_nType == ETYPE_BG_TUTORIAL)
	{// チュートリアルモードだったら
		State();
	}

	if (m_nType == ETYPE_BG_GAME)
	{// ゲームモードだったら
		// U座標の位置を加算
		m_fTexV += BG_SPPED;

		// 座標の更新
		m_paObject2D[0]->SetTexPos(0.0f, m_fTexV);
	}
}

//-----------------------------------------------------------------------------------------------
//　描画
//-----------------------------------------------------------------------------------------------
void CBg::Draw()
{

}

//-----------------------------------------------------------------------------------------------
// 種類の設定
//
// ETYPE_BG type → 背景の種類
//-----------------------------------------------------------------------------------------------
void CBg::SetType(ETYPE_BG type)
{
	m_nType = type;
}

//-----------------------------------------------------------------------------------------------
// 種類の取得
//-----------------------------------------------------------------------------------------------
CBg::ETYPE_BG CBg::GetType()
{
	return m_nType;
}

//-----------------------------------------------------------------------------------------------
// ページの設定
//-----------------------------------------------------------------------------------------------
void CBg::SetPage(TUTORIAL_PAGE page)
{
	m_page = page;
}

//-----------------------------------------------------------------------------------------------
// ページの取得
//-----------------------------------------------------------------------------------------------
CBg::TUTORIAL_PAGE CBg::GetPage()
{
	return m_page;
}

//-----------------------------------------------------------------------------------------------
// 状態
//-----------------------------------------------------------------------------------------------
void CBg::State()
{
	switch (m_page)
	{
		// 1ページ目
	case TUTORIAL_PAGE_ONE:
		m_paObject2D[0]->SetColor(D3DXCOLOR(1.0f, 1.0f, 1.0f, 1.0f));
		m_paObject2D[1]->SetColor(D3DXCOLOR(0.0f, 0.0f, 0.0f, 0.0f));
		break;
		// 2ページ目
	case TUTORIAL_PAGE_SECOND:
		m_paObject2D[0]->SetColor(D3DXCOLOR(0.0f, 0.0f, 0.0f, 0.0f));
		m_paObject2D[1]->SetColor(D3DXCOLOR(1.0f, 1.0f, 1.0f, 1.0f));
		break;
		// その他
	default:
		break;
	}
}